<!--<script src="{$wa_app_static_url}js/jquery.validate.js" type="text/javascript"></script>-->
<script language="javascript">
    $( document ).ready(function() {
        $.post( "{$wa_app_url}?module=matchs&action=select&magasin_id={$magasin_info.id}&provider_id={$provider_info.id}", function( data ) {

            $( ".select" ).each(function( index ) {
                var field_name = $(this).attr('data-field-id');
                var response = data;

                $(this).html(response);
                $(this).find("select").attr('name',field_name);

            });

            $.post( "{$wa_app_url}?module=matchs&action=values&magasin_id={$magasin_info.id}&provider_id={$provider_info.id}", function( data ) {
                var values = JSON.parse(data);
                $( "#adminForm select" ).each(function( index ) {
                    var name = $(this).attr("name");

                    $(this).val(values[name]['path'])

                    var name_key = name+'_has_a_key';
                    var has_a_key_checkbox = $("#adminForm input:checkbox[name='"+name_key+"']");
                    if(values[name]['has_a_key'] == 1) {
                        has_a_key_checkbox.prop('checked',true);
                    }

                    var name_multiply = name+'_multiply';
                    var multiply_checkbox = $("#adminForm input:checkbox[name='"+name_multiply+"']");
                    if(values[name]['multiply'] == 1) {
                        multiply_checkbox.prop('checked',true);
                    }

                });

                // $( "#adminForm checkbox" ).each(function( index ) {
                //     var name = $(this).attr("name");
                //     $(this).val(values[name]['path'])
                // });





            });
            // var select = $(this).find("select.validate");
            // select.validate({
            //     expression: "if (VAL) return true; else return false;",
            //     message: "Выберите значение из списка"
            // });
        });

        $( "#matchs_save" ).on( "click", function() {
            //alert('aa')
            var flag = 0;
            var count = 0;
            $("#adminForm select").each(function (index) {
                count++;
                var input = $(this);
                //alert('Name: ' + input.attr('name') + ' Value: ' + input.val());
                if(input.val() == '') {
                    alert('Заполните значение для '+ input.attr('name'));
                    flag = 1;
                    return false;
                }
            });
            if(flag == 0 && count > 0) {
             $("#adminForm").submit();
            }
        });


    });
</script>



<form action="index.php?module=matchs&action=save" method="post" id="adminForm" name="adminForm">

    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{$wa_app_url}">Магазины</a></li>
            <li class="breadcrumb-item"><a href="?module=setupmagasin&magasin_id={$magasin_info.id}">{$magasin_info.name}</a></li>
            <li class="breadcrumb-item active" aria-current="page">список полей: {$provider_info.name} <a href="{$provider_info.xml_url}" target="_blank">{$provider_info.xml_url}</a></li>
        </ol>
    </nav>

    <div class="mt-3"></div>
    <div style="float: left;">
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="return window.location.href = '?module=setupmagasin&magasin_id={$magasin_info.id}';">Вернуться</button>
        <button type="button" class="btn btn-outline-success btn-sm" id="matchs_save">Сохранить</button>
        <button type="button" class="btn btn-outline-info btn-sm" onclick="return window.location.href = '?module=readxml&provider_id={$provider_info.id}&magasin_id={$magasin_info.id}';">Прочитать</button>
    </div>

    <br /><br />

    <div style="margin-top: 10px;"></div>

    <div style="overflow:scroll;">
        <table class="table table-striped table-bordered table-hover">
            <caption>Соответствие полей продуктов</caption>
            <thead class="thead-light">
            <tr>
                {foreach from=$products_select item=r}

                    <th scope="col" >{$r.fields_products} </th>

                {/foreach}

            </tr>
            </thead>

            <tbody>
                {foreach from=$products_select item=r}
                    <td scope="col" >
                        <div class="select" data-field-id="{$r.fields_products}"></div>
                        <!--<div>has_a_list: <input type="checkbox" name="{$r.fields_products}_has_a_list" value=""> </div>-->
                        <div>ключ: <input type="checkbox" name="{$r.fields_products}_has_a_key" value=""> </div>
                        <div>множ.: <input type="checkbox" name="{$r.fields_products}_multiply" value=""> </div>
                    </td>
                {/foreach}
            </tbody>
        </table>
    </div>

    <!--<div>Тэг со списком для продуктов:</div>-->
    <!--<div class="select" data-field-id="db_table_products"></div>-->
    <br /><br />

    <div style="margin-top: 10px;"></div>

    <div >
        <table class="table table-striped table-bordered table-hover">
            <caption>Соответствие полей категорий</caption>
            <thead class="thead-light">
            <tr>
                {foreach from=$categories_select item=r}

                <th scope="col" >{$r.fields_categories} </th>

                {/foreach}

            </tr>
            </thead>

            <tbody>
                {foreach from=$categories_select item=r}
                    <td scope="col" >
                        <div class="select" data-field-id="{$r.fields_categories}"></div>
                        <!--<div>has_a_list: <input type="checkbox" name="{$r.fields_categories}_has_a_list" value=""> </div>-->
                        <div>ключ: <input type="checkbox" name="{$r.fields_categories}_has_a_key" value=""> </div>
                        <div>множ.: <input type="checkbox" name="{$r.fields_categories}_multiply" value=""> </div>
                    </td>
                {/foreach}
            </tbody>
        </table>
    </div>

    <!--<form action="index.php?module=matchs&action=save" method="post" id="db_table_form" name="db_table_form">-->
        <!--<div class="select" data-field-id="db_table_products"></div>-->

        <!--<div class="select" data-field-id="db_table_catetories"></div>-->
    <!--</form>-->


    <!--<div>Тэг со списком для категорий:</div>-->
    <!--<div class="select" data-field-id="db_table_categories"></div>-->


    <input type="hidden" name="module" value="matchs"/>
    <input type="hidden" name="magasin_id" value="{$magasin_info.id}">
    <input type="hidden" name="provider_id" value="{$provider_info.id}">


</form>